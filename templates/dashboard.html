<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ØªØ¯Ø§ÙˆÙ„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .balance {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 100px auto 30px;
            padding: 0 20px;
        }
        
        /* Bot Control Card */
        .bot-control {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .bot-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .bot-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .status-running {
            background: #d4edda;
            color: #155724;
        }
        
        .status-stopped {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-paused {
            background: #fff3cd;
            color: #856404;
        }
        
        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .control-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            min-width: 150px;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .stop-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .pause-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .control-btn:active {
            transform: translateY(0);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .positive {
            color: #10b981;
        }
        
        .negative {
            color: #ef4444;
        }
        
        /* Trades Table */
        .trades-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trades-table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
        }
        
        .trades-table th {
            background: #f8f9fa;
            padding: 12px 15px;
            text-align: right;
            color: #666;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 2px solid #eee;
        }
        
        .trades-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .trade-buy {
            color: #10b981;
            font-weight: 600;
        }
        
        .trade-sell {
            color: #ef4444;
            font-weight: 600;
        }
        
        .trade-profit {
            color: #10b981;
            font-weight: 600;
        }
        
        .trade-loss {
            color: #ef4444;
            font-weight: 600;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .action-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
        }
        
        .action-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .action-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .action-desc {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Manual Trading Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .modal-form {
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .modal-close {
            background: #6c757d;
            color: white;
        }
        
        .modal-submit {
            background: #667eea;
            color: white;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            margin-top: 30px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .main {
                margin-top: 150px;
            }
            
            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .trades-table {
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .bot-control,
            .stat-card,
            .trades-section,
            .action-card {
                padding: 20px 15px;
            }
            
            .stat-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                ğŸ¤– Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ
                <span id="liveTime" style="font-size: 0.9rem; opacity: 0.9;"></span>
            </div>
            <div class="user-info">
                <div class="balance">
                    ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: $<span id="currentBalance">{{ user.balance|round(2) }}</span>
                </div>
                <div class="balance" style="background: rgba(255,255,255,0.1);">
                    ğŸŒ {{ 'Testnet' if user.is_testnet else 'Real Account' }}
                </div>
                <a href="/logout" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main">
        <!-- Bot Control -->
        <div class="bot-control">
            <h2 class="bot-title">ğŸ¤– Ø¨ÙˆØª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ</h2>
            
            <div id="botStatusDisplay" class="bot-status status-stopped">
                â¹ï¸ Ù…ØªÙˆÙ‚Ù
            </div>
            
            <div class="control-buttons">
                <button class="control-btn start-btn" onclick="startBot()">
                    â–¶ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ
                </button>
                <button class="control-btn pause-btn" onclick="pauseBot()" style="display:none;">
                    â¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
                </button>
                <button class="control-btn stop-btn" onclick="stopBot()">
                    â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª
                </button>
            </div>
            
            <div id="botMessage" style="margin-top: 15px; color: #666;"></div>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ’¼</div>
                <div class="stat-value" id="activePositions">0</div>
                <div class="stat-label">Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value" id="totalTrades">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙ‚Ø§Øª</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“ˆ</div>
                <div class="stat-value" id="totalEquity">$0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">âš¡</div>
                <div class="stat-value" id="botUptime">00:00</div>
                <div class="stat-label">Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="action-card" onclick="openBuyModal()">
                <div class="action-icon">ğŸ’¹</div>
                <div class="action-title">Ø´Ø±Ø§Ø¡ Ø³Ø±ÙŠØ¹</div>
                <div class="action-desc">Ø´Ø±Ø§Ø¡ Ø¹Ù…Ù„Ø© Ø¨Ø³Ø±Ø¹Ø©</div>
            </div>
            
            <div class="action-card" onclick="openSellModal()">
                <div class="action-icon">ğŸ“‰</div>
                <div class="action-title">Ø¨ÙŠØ¹ Ø³Ø±ÙŠØ¹</div>
                <div class="action-desc">Ø¨ÙŠØ¹ Ø¹Ù…Ù„Ø© Ø¨Ø³Ø±Ø¹Ø©</div>
            </div>
            
            <div class="action-card" onclick="refreshData()">
                <div class="action-icon">ğŸ”„</div>
                <div class="action-title">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                <div class="action-desc">ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
            </div>
            
            <div class="action-card" onclick="openHelp()">
                <div class="action-icon">â“</div>
                <div class="action-title">Ù…Ø³Ø§Ø¹Ø¯Ø©</div>
                <div class="action-desc">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</div>
            </div>
        </div>
        
        <!-- Recent Trades -->
        <div class="trades-section">
            <h3 class="section-title">ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„ØµÙÙ‚Ø§Øª</h3>
            <div style="overflow-x: auto;">
                <table class="trades-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTableBody">
                        {% for trade in trades %}
                        <tr>
                            <td>{{ trade.timestamp[11:16] if trade.timestamp else '--' }}</td>
                            <td>{{ trade.symbol or '--' }}</td>
                            <td class="trade-{{ trade.side.lower() if trade.side else 'buy' }}">
                                {{ 'Ø´Ø±Ø§Ø¡' if trade.side == 'BUY' else 'Ø¨ÙŠØ¹' if trade.side == 'SELL' else '--' }}
                            </td>
                            <td>{{ trade.quantity|round(6) if trade.quantity else '--' }}</td>
                            <td>${{ trade.price|round(4) if trade.price else '--' }}</td>
                            <td>{{ trade.status or '--' }}</td>
                            <td class="{{ 'trade-profit' if trade.pnl and trade.pnl > 0 else 'trade-loss' if trade.pnl and trade.pnl < 0 else '' }}">
                                {{ '$' + trade.pnl|string|round(2) if trade.pnl else '--' }}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Info Box -->
        <div class="trades-section" style="background: #f0f8ff; border-right: 4px solid #4facfe;">
            <h3 class="section-title">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <div style="line-height: 1.8; color: #555;">
                <p>âœ… <strong>Ù…Ø³ØªØ­Ø³Ù†:</strong> Ø§Ø¨Ø¯Ø£ Ø¨Ù€ Testnet Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹</p>
                <p>ğŸ“± <strong>Ù…Ù…ÙŠØ²Ø§Øª:</strong> ÙŠØ¹Ù…Ù„ 24/7 - Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù‡Ø§ØªÙ - ØªØ¯Ø§ÙˆÙ„ Ø¢Ù„ÙŠ</p>
                <p>âš¡ <strong>Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©:</strong> Trend Following Ù…Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± ØµØ§Ø±Ù…Ø©</p>
                <p>âš ï¸ <strong>ØªØ­Ø°ÙŠØ±:</strong> Ù„Ø§ ØªØ®Ø§Ø·Ø± Ø¨Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø®Ø³Ø§Ø±ØªÙ‡</p>
                <p>ğŸ”’ <strong>Ø§Ù„Ø£Ù…Ø§Ù†:</strong> Ù…ÙØ§ØªÙŠØ­ API Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·</p>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        ğŸ¤– Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ Ø¹Ù„Ù‰ Binance | Ù…ØµÙ…Ù… Ù„Ù„ØªØ¯Ø§ÙˆÙ„ Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ
        <br>âš ï¸ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© ÙÙŠ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø¹Ø§Ù„ÙŠØ© - Ø§Ø¨Ø¯Ø£ Ø¨Ø±Ø£Ø³ Ù…Ø§Ù„ ØµØºÙŠØ±
    </div>
    
    <!-- Buy Modal -->
    <div id="buyModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ’¹ Ø´Ø±Ø§Ø¡ Ø³Ø±ÙŠØ¹</h3>
            <form class="modal-form" onsubmit="return quickBuy(event)">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #333;">Ø§Ù„Ø¹Ù…Ù„Ø©:</label>
                    <select id="buySymbol" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                        <option value="BTCUSDT">BTCUSDT</option>
                        <option value="ETHUSDT">ETHUSDT</option>
                        <option value="BNBUSDT">BNBUSDT</option>
                        <option value="ADAUSDT">ADAUSDT</option>
                        <option value="DOGEUSDT">DOGEUSDT</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #333;">Ø§Ù„Ù…Ø¨Ù„Øº (USDT):</label>
                    <input type="number" id="buyAmount" min="5" max="1000" step="1" 
                           value="10" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                </div>
                <div style="margin-bottom: 20px; color: #666; font-size: 0.9rem;">
                    âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 5 USDT
                </div>
                <div class="modal-buttons">
                    <button type="button" class="modal-btn modal-close" onclick="closeModal('buyModal')">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="modal-btn modal-submit">
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Sell Modal -->
    <div id="sellModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ“‰ Ø¨ÙŠØ¹ Ø³Ø±ÙŠØ¹</h3>
            <form class="modal-form" onsubmit="return quickSell(event)">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #333;">Ø§Ù„Ø¹Ù…Ù„Ø©:</label>
                    <select id="sellSymbol" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                        <option value="BTCUSDT">BTCUSDT</option>
                        <option value="ETHUSDT">ETHUSDT</option>
                        <option value="BNBUSDT">BNBUSDT</option>
                        <option value="ADAUSDT">ADAUSDT</option>
                        <option value="DOGEUSDT">DOGEUSDT</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #333;">Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
                    <input type="number" id="sellQuantity" min="0.001" max="100" step="0.001" 
                           value="0.01" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                </div>
                <div style="margin-bottom: 20px; color: #666; font-size: 0.9rem;">
                    âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¨ÙŠØ¹Ù‡Ø§
                </div>
                <div class="modal-buttons">
                    <button type="button" class="modal-btn modal-close" onclick="closeModal('sellModal')">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="modal-btn modal-submit">
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Live time update
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('liveTime').textContent = timeString;
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // Bot status and auto-refresh
        let botStartTime = null;
        let refreshInterval;
        
        function updateBotStatus() {
            fetch('/api/bot_status')
                .then(response => response.json())
                .then(data => {
                    const statusDiv = document.getElementById('botStatusDisplay');
                    const messageDiv = document.getElementById('botMessage');
                    
                    if (data.status === 'running') {
                        statusDiv.className = 'bot-status status-running';
                        statusDiv.innerHTML = 'ğŸŸ¢ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†';
                        
                        // Update stats
                        document.getElementById('activePositions').textContent = 
                            data.data.active_positions || 0;
                        document.getElementById('totalTrades').textContent = 
                            data.data.total_trades || 0;
                        document.getElementById('totalEquity').textContent = 
                            '$' + (data.data.equity || 0).toFixed(2);
                        
                        // Calculate uptime
                        if (!botStartTime) {
                            botStartTime = new Date();
                        }
                        const uptime = Math.floor((new Date() - botStartTime) / 1000);
                        const hours = Math.floor(uptime / 3600);
                        const minutes = Math.floor((uptime % 3600) / 60);
                        document.getElementById('botUptime').textContent = 
                            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                        
                        messageDiv.textContent = 'âœ… Ø§Ù„Ø¨ÙˆØª ÙŠØ¨Ø­Ø« Ø¹Ù† ÙØ±Øµ ØªØ¯Ø§ÙˆÙ„...';
                    } else {
                        statusDiv.className = 'bot-status status-stopped';
                        statusDiv.innerHTML = 'â¹ï¸ Ù…ØªÙˆÙ‚Ù';
                        messageDiv.textContent = 'Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ" Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª';
                        botStartTime = null;
                    }
                })
                .catch(error => {
                    console.error('Error updating bot status:', error);
                });
            
            // Update balance
            fetch('/api/get_balance')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('currentBalance').textContent = 
                        data.balance.toFixed(2);
                });
            
            // Update trades
            fetch('/api/get_trades')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('tradesTableBody');
                    tbody.innerHTML = '';
                    
                    if (data.trades.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                                    Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    data.trades.reverse().forEach(trade => {
                        const time = trade.timestamp ? trade.timestamp.substr(11, 5) : '--';
                        const typeClass = trade.side === 'BUY' ? 'trade-buy' : 'trade-sell';
                        const typeText = trade.side === 'BUY' ? 'Ø´Ø±Ø§Ø¡' : 
                                        trade.side === 'SELL' ? 'Ø¨ÙŠØ¹' : '--';
                        const pnlClass = trade.pnl > 0 ? 'trade-profit' : 
                                        trade.pnl < 0 ? 'trade-loss' : '';
                        const pnlText = trade.pnl ? 
                            '$' + Math.abs(trade.pnl).toFixed(2) : '--';
                        
                        tbody.innerHTML += `
                            <tr>
                                <td>${time}</td>
                                <td>${trade.symbol || '--'}</td>
                                <td class="${typeClass}">${typeText}</td>
                                <td>${trade.quantity ? Number(trade.quantity).toFixed(6) : '--'}</td>
                                <td>${trade.price ? '$' + Number(trade.price).toFixed(4) : '--'}</td>
                                <td>${trade.status || '--'}</td>
                                <td class="${pnlClass}">${pnlText}</td>
                            </tr>
                        `;
                    });
                });
        }
        
        // Start auto-refresh
        function startAutoRefresh() {
            updateBotStatus();
            refreshInterval = setInterval(updateBotStatus, 10000); // ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
        }
        
        // Bot control functions
        function startBot() {
            fetch('/api/start_bot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                updateBotStatus();
                
                if (data.status === 'success') {
                    startAutoRefresh();
                }
            })
            .catch(error => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error);
            });
        }
        
        function stopBot() {
            if (!confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØªØŸ Ø³ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª.')) {
                return;
            }
            
            fetch('/api/stop_bot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                updateBotStatus();
                clearInterval(refreshInterval);
            })
            .catch(error => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error);
            });
        }
        
        function pauseBot() {
            alert('â¸ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }
        
        // Modal functions
        function openBuyModal() {
            document.getElementById('buyModal').style.display = 'flex';
        }
        
        function openSellModal() {
            document.getElementById('sellModal').style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Quick buy/sell
        function quickBuy(event) {
            event.preventDefault();
            
            const symbol = document.getElementById('buySymbol').value;
            const amount = parseFloat(document.getElementById('buyAmount').value);
            
            if (amount < 5) {
                alert('âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø´Ø±Ø§Ø¡ Ù‡Ùˆ 5 USDT');
                return false;
            }
            
            fetch('/api/quick_buy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    symbol: symbol,
                    amount: amount
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    closeModal('buyModal');
                    updateBotStatus();
                }
            })
            .catch(error => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error);
            });
            
            return false;
        }
        
        function quickSell(event) {
            event.preventDefault();
            
            const symbol = document.getElementById('sellSymbol').value;
            const quantity = parseFloat(document.getElementById('sellQuantity').value);
            
            if (quantity <= 0) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©');
                return false;
            }
            
            fetch('/api/quick_sell', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    symbol: symbol,
                    quantity: quantity
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    closeModal('sellModal');
                    updateBotStatus();
                }
            })
            .catch(error => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error);
            });
            
            return false;
        }
        
        // Helper functions
        function refreshData() {
            updateBotStatus();
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
        function openHelp() {
            alert(`
ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹:

1. ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: 2026y
2. âš™ï¸ Ø¥Ø¶Ø§ÙØ© Ù…ÙØ§ØªÙŠØ­ Binance API Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
3. ğŸš€ Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ"
4. ğŸ“Š Ø´Ø§Ù‡Ø¯ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
5. â¹ï¸ Ø§Ø¶ØºØ· "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª" Ù„Ù„ØªÙˆÙ‚Ù

ğŸ’¡ Ù†ØµØ§Ø¦Ø­:
- Ø§Ø¨Ø¯Ø£ Ø¨Ù€ Testnet Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ØªØ¯Ø±ÙŠØ¨
- Ù„Ø§ ØªØ®Ø§Ø·Ø± Ø¨Ø£ÙƒØ«Ø± Ù…Ù† 10% Ù…Ù† Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„
- Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¨ÙˆØª ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            `);
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateBotStatus();
            startAutoRefresh();
        });
    </script>
</body>
                      </html>
